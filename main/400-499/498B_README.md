# CF498B Name That Tune 题解

由期望的线性性质可知，累加每首歌的期望，就是总期望。
考虑其中一首歌，设其在 T 秒内被识别出的概率是 q，那么这首歌对总期望的贡献是 1*q + 0*(1-q) = q，正好等于概率。
所以累加每首歌在 T 秒内被识别出的概率，就是总期望。

「T 秒内」等价于「第 1,2,3,...,T 秒」。
计算每首歌分别在恰好第 1,2,3,...,T 秒被识别出的概率，累加，就是这首歌在 T 秒内被识别出的概率。
注：比如第二首歌，无法在第 1 秒被识别出，那么这个时刻识别出它的概率为 0。

定义 f[i][j] 表示第 i 首歌恰好在第 j 秒被识别出的概率。
比如 1 秒就识别出第 i 首歌，那么问题变成第 i-1 首歌恰好在第 j-1 秒被识别出的概率，即 f[i-1][j-1]。

以 t[i] = 4 为例，我们有（下文 p 表示 p[i]，t 表示 t[i]）
f[i][j] = f[i-1][j-1] * p + f[i-1][j-2] * (1-p)*p + f[i-1][j-3] * (1-p)^2*p + f[i-1][j-4] * (1-p)^3
对比 f[i][j-1] 和 f[i][j] 的转移方程，比较相似之处（请在草稿纸上推导，回想一下错位相减法），可得
f[i][j] = f[i-1][j-1] * p + (f[i][j-1] - f[i-1][j-5] * (1-p)^3) * (1-p) + f[i-1][j-4] * (1-p)^4
一般地
f[i][j] = f[i-1][j-1] * p + (f[i][j-1] - f[i-1][j-t-1] * (1-p)^(t-1)) * (1-p) + f[i-1][j-t] * (1-p)^t
（我代码中把 f[i-1][j-1] * p 移到了右边，只是改了下位置）

初始值 f[0][0] = 1。
答案为 f[i][j] 之和，其中 1<=i<=n 且 1<=j<=T。
